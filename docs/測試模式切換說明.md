# 測試模式切換說明

## 概述

本實驗平台支援兩種運行模式：
- **測試模式**：用於快速測試和開發，2人一組，3回合
- **正式模式**：用於正式實驗，15人一組，15回合

## 模式切換方法

### 統一開關設定

在 `configs/experiment_config.yaml` 檔案中，使用統一的主開關來控制模式：

```yaml
# ====================================
# 實驗模式切換（主開關）
# ====================================
experiment_mode:
  # 主開關：true = 測試模式, false = 正式模式
  test_mode_enabled: true
```

只需要修改 `test_mode_enabled` 的值：
- 設為 `true`：啟用測試模式
- 設為 `false`：啟用正式模式

### 配置檔案結構

配置檔案現在採用更清晰的結構：

1. **主開關區塊** (`experiment_mode`)
   - 統一控制整個系統的模式

2. **通用設定區塊** (`general`)
   - 定義正式模式的所有參數

3. **測試模式覆蓋區塊** (`test_mode_overrides`)
   - 定義測試模式下需要覆蓋的參數
   - 系統會自動使用這些參數替換通用設定

4. **各階段設定區塊** (`stages`)
   - 定義各實驗階段的正式模式參數

## 模式差異對照表

| 參數 | 測試模式 | 正式模式 |
|------|----------|----------|
| 每組人數 | 2人 | 15人 |
| 回合數 | 3回合 | 15回合 |
| 最大生產量 | 10 | 50 |
| 主導廠商數 | 1 | 3 |
| 非主導廠商數 | 1 | 12 |
| 初始資金（Control/CarbonTax） | 1000 | 300 |
| 初始資金（MUDA/CarbonTrading） | 99999 | 10000 |
| 交易時間（MUDA） | 60秒 | 180秒 |
| 交易時間（CarbonTrading） | 60秒 | 120秒 |
| 碳權配額 | 5 | 10 |
| 市場價格選項 | [30, 35] | [25, 30, 35, 40] |
| 碳稅率選項 | [2, 3] | [1, 2, 3] |

## 程式碼相容性

系統保留了對舊代碼的相容性：
- `config.test_mode` 屬性仍然可用
- `config.production_mode` 屬性仍然可用

但建議使用新的方法：
- `config.is_test_mode_enabled()` 檢查是否為測試模式

## 注意事項

1. 切換模式後需要重新啟動 oTree 伺服器
2. 測試模式下會確保玩家1為主導廠商，方便測試
3. 正式模式下角色分配是隨機的
4. 測試模式的參數都定義在 `test_mode_overrides` 區塊中，方便集中管理

## 快速切換

如果需要頻繁切換模式，可以使用以下命令：

```bash
# 切換到測試模式
sed -i 's/test_mode_enabled: false/test_mode_enabled: true/' configs/experiment_config.yaml

# 切換到正式模式
sed -i 's/test_mode_enabled: true/test_mode_enabled: false/' configs/experiment_config.yaml
```

或者在 Windows PowerShell 中：

```powershell
# 切換到測試模式
(Get-Content configs/experiment_config.yaml) -replace 'test_mode_enabled: false', 'test_mode_enabled: true' | Set-Content configs/experiment_config.yaml

# 切換到正式模式
(Get-Content configs/experiment_config.yaml) -replace 'test_mode_enabled: true', 'test_mode_enabled: false' | Set-Content configs/experiment_config.yaml
``` 