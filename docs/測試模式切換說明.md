# 測試模式與正式模式切換說明

## 概述

本實驗平台支援兩種運行模式：
- **測試模式 (Test Mode)**：用於開發測試，參數簡化，人數較少
- **正式模式 (Production Mode)**：用於正式實驗，完整參數，15 人一組

## 模式差異對比

| 項目 | 測試模式 | 正式模式 |
|------|----------|----------|
| 每組人數 | 2 人 | 15 人 |
| 回合數 | 3 回合 | 15 回合 |
| 主導廠商數量 | 1 個（50%） | 3 個（固定） |
| 其他廠商數量 | 1 個（50%） | 12 個（固定） |
| 1 號玩家角色 | 確保為主導廠商 | 隨機分配 |
| 初始資金 | 較高（測試用） | 正常 |
| 交易時間 | 60 秒 | 120-180 秒 |
| 市場價格選項 | 簡化（2 個） | 完整（4 個） |

## 切換方法

### 方法一：修改 YAML 配置檔案
編輯 `configs/experiment_config.yaml`：

```yaml
# 啟用測試模式
test_mode:
  enabled: true  # 改為 true 啟用測試模式

# 停用測試模式（使用正式模式）
test_mode:
  enabled: false  # 改為 false 使用正式模式
```

### 方法二：在程式碼中動態切換
在需要的地方（如 settings.py）新增：

```python
from configs.config import config

# 啟用測試模式
config.set_test_mode(True)

# 啟用正式模式
config.set_test_mode(False)
```

### 方法三：環境變數控制（建議未來實作）
```bash
# Linux/Mac
export EXPERIMENT_TEST_MODE=true

# Windows
set EXPERIMENT_TEST_MODE=true
```

## 測試模式特性

### 1. 玩家分配邏輯
- **測試模式**：確保 1 號玩家始終為主導廠商（方便測試）
- **正式模式**：完全隨機分配 3 個主導廠商

### 2. 參數簡化
測試模式下的參數都經過簡化：
- 市場價格選項：[30, 35] 而非 [25, 30, 35, 40]
- 稅率選項：[2, 3] 而非 [1, 2, 3]
- 碳權倍率：[1.0] 而非 [0.8, 1.0, 1.2]

### 3. 資金設定
- 測試模式給予大量初始資金（如 99999）避免資金限制影響測試
- 正式模式使用真實的資金限制

## 配置檔案結構

`configs/experiment_config.yaml` 現在分為兩個主要區塊：

1. **general** 區塊：正式實驗的所有參數
2. **test_mode** 區塊：測試模式的覆蓋參數

測試模式啟用時，系統會優先使用 test_mode 區塊中的參數，如果沒有定義則使用 general 區塊的參數。

## 注意事項

1. 切換模式後需要重新啟動 oTree 伺服器
2. 正在進行的實驗不受影響，只影響新建立的 session
3. 確保正式實驗前將 `test_mode.enabled` 設為 `false`
4. 測試模式的數據不應用於正式分析

## 驗證當前模式

在 oTree 控制台或日誌中會顯示：
```
初始化 2 個玩家的角色...
角色分配: 1 個 dominant 廠商, 1 個 non-dominant 廠商
測試模式: 是
```

或正式模式：
```
初始化 15 個玩家的角色...
角色分配: 3 個 dominant 廠商, 12 個 non-dominant 廠商
測試模式: 否
``` 